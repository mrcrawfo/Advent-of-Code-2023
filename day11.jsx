// https://jsfiddle.net/mrcrawfo/psfowzqu/17/

const input1 = [
	'...#......',
	'.......#..',
	'#.........',
	'..........',
	'......#...',
	'.#........',
	'.........#',
	'..........',
	'.......#..',
	'#...#.....',
];

const input2 = [
  '.......#..........................................................................#.........................................................',
  '....................#.........#............#.........................#.......................#..............................................',
  '.#.......................................................#.................#.........................................................#......',
  '..............#.................................#................#....................................................#.....................',
  '..................................#......................................................................#..................................',
  '..................#..................................#.............................#.......#...............................#................',
  '.......#...............................#...................#................................................................................',
  '........................................................................#....................................#........................#.....',
  '..#...........................................................................................................................#.............',
  '............#............#..............................................................................#...................................',
  '...........................................#.....................................................#................#.........................',
  '.....................................................................#...........................................................#..........',
  '...............#....................#.......................................................................................................',
  '#.....................................................#.......................................#............................#..........#.....',
  '.....#................#......#................................................#.............................................................',
  '.......................................#.......................#.......#..............#..................#......#...........................',
  '............................................................................................................................................',
  '...................................................#..............................................#.............................#........#..',
  '..........#........................................................................................................#........................',
  '...............................................#.............................#............#...........#.....................................',
  '....................#..........................................................................................#........#...................',
  '....#.........#............#...............................................................................................................#',
  '....................................#................................#.............#............#...........................................',
  '...............................#..................................................................................#.........................',
  '#...............................................#........#.....................................................................#............',
  '......#........................................................#......................................................#.....................',
  '..........................................#....................................#............................................................',
  '..................#.....................................................................#..................................#.......#........',
  '.............................................................................................#..............................................',
  '.............#........#...........#..........................#............................................#.......#.........................',
  '........#...................#.......................#...................#..................................................................#',
  '.................................................................................#.......................................#..................',
  '................................................................#...........................................................................',
  '...............................................#...........#..........................................#.....#...............................',
  '..........................................#....................................................................................#............',
  '.......#.....#............................................................................#.............................................#...',
  '......................#....................................................#....................................#...........................',
  '.................#...................#................#....................................................................#................',
  '..#...............................................................#...................#.............................#.......................',
  '.............................................................................................#..............................................',
  '.........#..........#.......................................................................................................................',
  '...............................#.........#.......#...............................#.........................................................#',
  '......................................................................................................#...................#.....#...........',
  '........................................................................................#..................#................................',
  '..#.........................................................................................................................................',
  '....................................................................................................................#...................#...',
  '......................#..............................#..........#...........................................................................',
  '......................................................................#..........................................................#..........',
  '#.......................................#......................................................................#............................',
  '.....#..........................#...........................................................................................................',
  '..................#...............................#............................#........................#.................#.................',
  '..........................................................#.................................#...............................................',
  '.......................#..............................................................................................#...........#.....#...',
  '............................................................................................................................................',
  '.......#............................................#.......................................................................................',
  '...............#................#......#......................#......................................#......................................',
  '.....................................................................................#......................................................',
  '............................................................................................................................................',
  '............................................................................................................................................',
  '...#........................................................#...........................#.....#.........................#.........#.........',
  '............................................................................................................................................',
  '...........#..........#......#................................................................................#.............#...............',
  '.......................................#.................................................................................................#..',
  '...............................................#...............#............................................................................',
  '.............................................................................#.....................................#........................',
  '....#..............#..................................................#............#........................................................',
  '..............................#......................#..........................................#.....................................#.....',
  '..............#..........................#...........................................................#......................................',
  '................................................#..............................#..............................#..........#.......#..........',
  '............................................................#...............................................................................',
  '.#........................#.................................................................................................................',
  '...............................#...........................................................#................................................',
  '.............#........................................#........#..................................................#.........................',
  '...........................................#...........................................................#...................#................',
  '.........#.......................................#............................#.......#...................................................#.',
  '.....................................................................#.............................................................#........',
  '...........................................................#................................................................................',
  '.....................................................#......................................#.......#..............#...........#............',
  '............................................................................................................................................',
  '#..........#.....................#..............................................................#........................#..................',
  '...........................#...................#...............................#.....#..................................................#...',
  '................................................................#...........................................................................',
  '.......................................#..................#.......................................................................#.........',
  '...........................................................................................................#................................',
  '......#...............................................#......................#.................#.......................#....................',
  '...............................#..................................#.............................................#....................#......',
  '...........#......................................................................#................#............................#...........',
  '.........................#.........#...............#........................................................................................',
  '.#.........................................#...........................#..................................................................#.',
  '....................#.........................................#.............#...........................................#...................',
  '............................#...................................................................#............................#..............',
  '............................................................................................................................................',
  '.............#..............................................................................#...............#.........................#.....',
  '#......#..........................#...............................................................................#.........................',
  '...............................................#.......................#..................................................................#.',
  '.....................#......................................................................................................................',
  '............................................................#......................#.........................................#......#.......',
  '.........................#............................#................................................................#....................',
  '..#..............................#...............................#..........................................................................',
  '.......................................................................................#.............#..........#...........................',
  '.............#.........................#....................................................................................................',
  '..................................................#...............................#.........................................#...............',
  '...................#..........................................................................#.............................................',
  '.#....................................................#.......#..........................................#......................#.....#.....',
  '...............................#............................................................................................................',
  '..............#....................................................#..........#....................#......................................#.',
  '.........................................................#..............................#..........................#........................',
  '.....#.........................................................................................#.............#..........#...................',
  '..................................#................................................................................................#........',
  '#........................#..................................................................................................................',
  '....................#.......................#................................#..............................................................',
  '...........#.......................................................................#...................#......................#.............',
  '..............................................................#...................................................#.........................',
  '...............................#..................#............................................#............................................',
  '................#.........#.............#............................#....................#................#................................',
  '.#..........................................................................................................................................',
  '........#...................................................................................................................................',
  '..................................#...................................................#.............................................#.......',
  '.................................................................................#..........................................................',
  '.............................#..........................#.....................................#....................#.......................#',
  '........................................#..........................#........................................#...........#.....#.............',
  '......................................................................................................#.....................................',
  '..........#......#.......#....................................................#......................................................#......',
  '.....#...............................................#.................................#........#...........................................',
  '#...........................................#...................................................................................#...........',
  '..............................#..............................#.....................#.......#................................................',
  '......................#.........................#.........................................................................................#.',
  '.......#...........................#.......................................#...............................#............#...................',
  '............#.............................................#........................................#........................................',
  '.....................................................#..............#................#......................................................',
  '............................................................................................................................................',
  '.........................#.................................................................#............#.....................#.............',
  '..................#..........................................................#..................................#......#..................#.',
  '.#.................................................#..........#.........#.........#.........................................................',
  '.......#.........................#.......#..............#..........................................#........................................',
  '.....................#.....#..............................................................................#.................................',
  '...........................................................................#.....................................................#..........',
  '......................................#.........................................................#........................................#..',
  '#...............#...................................#.....................................#............#.................#..................',
  '.............................................#.........................#..........#.............................#...........................',
];

const getExpandedRowsAndCols = (input) => {
	let expandRows = [];
  let expandCols = [];
  
  for (let r = 0; r < input.length; r++) {
  	if (input[r].split('').every((col) => col === '.')) {
    	expandRows.push(r);
    }
  }
  
  for (let c = 0; c < input[0].length; c++) {
		if (input.every((row) => row[c] === '.')) {
    	expandCols.push(c);
    }
  }
  
  return [expandRows, expandCols];
}

const getExpandedGrid = (input) => {
  let [expandRows, expandCols] = getExpandedRowsAndCols(input);
  
  for (let r = 0; r < expandRows.length; r++) {
  	input.splice(expandRows[r] + r, 0, input[expandRows[r] + r]);
  }
  
  for (let c = 0; c < expandCols.length; c++) {
  	for (let r = 0; r < input.length; r++) {
    	input[r] = input[r].substring(0, expandCols[c] + c) + '.' + input[r].substring(expandCols[c] + c, input[r].length);
    }
  }
  
  return input;
};

const processGalaxies = (grid) => {
	let galaxies = [];
  for (let r = 0; r < grid.length; r++) {
  	for (let c = 0; c < grid[r].length; c++) {
    	if (grid[r][c] === '#') {
      	galaxies.push({ r, c });
      }
    }
  }
  return galaxies;
};

const test1 = (input) => {
	const grid = getExpandedGrid(input);
  const galaxies = processGalaxies(grid);
  let total = 0;
  for (let a = 0; a < galaxies.length; a++) {
  	for (let b = galaxies.length - 1; b >= a; b--) {
    	let gA = galaxies[a];
      let gB = galaxies[b];
      total += (Math.abs(gA.r - gB.r) + Math.abs(gA.c - gB.c));
    }
  }
  
  return total;
}

console.log('Answer - Part 1 - Input 1');
console.log(test1(input1));
// 374
console.log('Answer - Part 1 - Input 2');
console.log(test1(input2));
// 9609130

const test2 = (input, factor) => {
  let [expandRows, expandCols] = getExpandedRowsAndCols(input);
  const galaxies = processGalaxies(input);
  let total = 0;
  for (let a = 0; a < galaxies.length; a++) {
  	for (let b = galaxies.length - 1; b >= a; b--) {
    	let gA = galaxies[a];
      let gB = galaxies[b];
      let expandRowsCrossed = 0;
      let expandColsCrossed = 0;
      for (let r = 0; r < expandRows.length; r++) {
      	let expandRow = expandRows[r];
        if ((gA.r < expandRow && expandRow < gB.r) || (gA.r > expandRow && expandRow > gB.r)) {
        	expandRowsCrossed++;
        }
      }
      for (let c = 0; c < expandCols.length; c++) {
      	let expandCol = expandCols[c];
        if ((gA.c < expandCol && expandCol < gB.c) || (gA.c > expandCol && expandCol > gB.c)) {
        	expandColsCrossed++;
        }
      }
      // not sure why bug is counting expandRowsCrossed and expandColsCrossed to be doubled; workaround by dividing each by two
      total += (Math.abs(gA.r - gB.r) + (expandRowsCrossed * factor / 2.0) - expandRowsCrossed + Math.abs(gA.c - gB.c) + (expandColsCrossed * factor / 2.0) - expandColsCrossed);
    }
  }
  
  return total;
}

console.log('Answer - Part 2 - Input 1 - 10');
console.log(test2(input1, 10));
// 1030
console.log('Answer - Part 2 - Input 1 - 100');
console.log(test2(input1, 100));
// 8410
console.log('Answer - Part 2 - Input 1 - 1000000');
console.log(test2(input1, 1000000));
// 82000210
console.log('Answer - Part 2 - Input 2 - 1000000');
console.log(test2(input2, 1000000));
// 702152204842

